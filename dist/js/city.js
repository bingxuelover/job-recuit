!function(t){"function"==typeof define&&define.amd?define(["jquery","ChineseDistricts"],t):"object"==typeof exports?t(require("jquery"),require("ChineseDistricts")):t(jQuery,ChineseDistricts)}(function(h,r){"use strict";if(void 0===r)throw new Error('The file "city-picker.data.js" must be included first!');var o="citypicker",s="change."+o,l="province",p="city",u="district";function a(t,e){this.$element=h(t),this.$dropdown=null,this.options=h.extend({},a.DEFAULTS,h.isPlainObject(e)&&e),this.active=!1,this.dems=[],this.needBlur=!1,this.init()}a.prototype={constructor:a,init:function(){this.defineDems(),this.render(),this.bind(),this.active=!0},render:function(){var t=this.getPosition(),e=this.$element.attr("placeholder")||this.options.placeholder,i='<span class="city-picker-span" style="'+this.getWidthStyle(t.width)+"height:"+t.height+"px;line-height:"+(t.height-1)+'px;">'+(e?'<span class="placeholder">'+e+"</span>":"")+'<span class="title"></span><div class="arrow"></div></span>',s='<div class="city-picker-dropdown" style="left:0px;top:100%;'+this.getWidthStyle(t.width,!0)+'"><div class="city-select-wrap"><div class="city-select-tab"><a class="active" data-count="province">省份</a>'+(this.includeDem("city")?'<a data-count="city">城市</a>':"")+(this.includeDem("district")?'<a data-count="district">区县</a>':"")+'</div><div class="city-select-content"><div class="city-select province" data-count="province"></div>'+(this.includeDem("city")?'<div class="city-select city" data-count="city"></div>':"")+(this.includeDem("district")?'<div class="city-select district" data-count="district"></div>':"")+"</div></div>";this.$element.addClass("city-picker-input"),this.$textspan=h(i).insertAfter(this.$element),this.$dropdown=h(s).insertAfter(this.$textspan);var n=this.$dropdown.find(".city-select");h.each(this.dems,h.proxy(function(t,e){this["$"+e]=n.filter("."+e)},this)),this.refresh()},refresh:function(i){this.$dropdown.find(".city-select").data("item",null);var s=this.$element.val()||"";s=s.split("/"),h.each(this.dems,h.proxy(function(t,e){s[t]&&t<s.length?this.options[e]=s[t]:i&&(this.options[e]=""),this.output(e)},this)),this.tab(l),this.feedText(),this.feedVal()},defineDems:function(){var i=!1;h.each([l,p,u],h.proxy(function(t,e){i||this.dems.push(e),e===this.options.level&&(i=!0)},this))},includeDem:function(t){return-1!==h.inArray(t,this.dems)},getPosition:function(){var t,e,i,s,n;return t=this.$element.position(),e=(s=this.getSize(this.$element)).height,i=s.width,this.options.responsive&&(n=this.$element.offsetParent().width())&&(.99<(i/=n)&&(i=1),i=100*i+"%"),{top:t.top||0,left:t.left||0,height:e,width:i}},getSize:function(t){var e,i,s;return t.is(":visible")?s={width:t.outerWidth(),height:t.outerHeight()}:((e=h("<div />").appendTo(h("body"))).css({position:"absolute !important",visibility:"hidden !important",display:"block !important"}),s={width:(i=t.clone().appendTo(e)).outerWidth(),height:i.outerHeight()},e.remove()),s},getWidthStyle:function(t,e){return this.options.responsive&&!h.isNumeric(t)?"width:"+t+";":"width:"+(e?Math.max(320,t):t)+"px;"},bind:function(){var c=this;h(document).on("click",this._mouteclick=function(t){var e,i,s,n=h(t.target);n.is(".city-picker-span")?i=n:n.is(".city-picker-span *")&&(i=n.parents(".city-picker-span")),n.is(".city-picker-input")&&(s=n),n.is(".city-picker-dropdown")?e=n:n.is(".city-picker-dropdown *")&&(e=n.parents(".city-picker-dropdown")),(!s&&!i&&!e||i&&i.get(0)!==c.$textspan.get(0)||s&&s.get(0)!==c.$element.get(0)||e&&e.get(0)!==c.$dropdown.get(0))&&c.close(!0)}),this.$element.on("change",this._changeElement=h.proxy(function(){this.close(!0),this.refresh(!0)},this)).on("focus",this._focusElement=h.proxy(function(){this.needBlur=!0,this.open()},this)).on("blur",this._blurElement=h.proxy(function(){this.needBlur&&(this.needBlur=!1,this.close(!0))},this)),this.$textspan.on("click",function(t){var e,i=h(t.target);c.needBlur=!1,i.is(".select-item")?(e=i.data("count"),c.open(e)):c.$dropdown.is(":visible")?c.close():c.open()}).on("mousedown",function(){c.needBlur=!1}),this.$dropdown.on("click",".city-select a",function(){var t=h(this).parents(".city-select"),e=t.find("a.active"),i=0===t.next().length;e.removeClass("active"),h(this).addClass("active"),e.data("code")!==h(this).data("code")&&(t.data("item",{address:h(this).attr("title"),code:h(this).data("code")}),h(this).trigger(s),c.feedText(),c.feedVal(),i&&c.close())}).on("click",".city-select-tab a",function(){if(!h(this).hasClass("active")){var t=h(this).data("count");c.tab(t)}}).on("mousedown",function(){c.needBlur=!1}),this.$province&&this.$province.on(s,this._changeProvince=h.proxy(function(){this.output(p),this.output(u),this.tab(p)},this)),this.$city&&this.$city.on(s,this._changeCity=h.proxy(function(){this.output(u),this.tab(u)},this))},open:function(t){t=t||l,this.$dropdown.show(),this.$textspan.addClass("open").addClass("focus"),this.tab(t)},close:function(t){this.$dropdown.hide(),this.$textspan.removeClass("open"),t&&this.$textspan.removeClass("focus")},unbind:function(){h(document).off("click",this._mouteclick),this.$element.off("change",this._changeElement),this.$element.off("focus",this._focusElement),this.$element.off("blur",this._blurElement),this.$textspan.off("click"),this.$textspan.off("mousedown"),this.$dropdown.off("click"),this.$dropdown.off("mousedown"),this.$province&&this.$province.off(s,this._changeProvince),this.$city&&this.$city.off(s,this._changeCity)},getText:function(){var i="";return this.$dropdown.find(".city-select").each(function(){var t=h(this).data("item"),e=h(this).data("count");t&&(i+=(h(this).hasClass("province"),'<span class="select-item" data-count="'+e+'" data-code="'+t.code+'">'+t.address+"</span>"))}),i},getPlaceHolder:function(){return this.$element.attr("placeholder")||this.options.placeholder},feedText:function(){this.getText()?(this.$textspan.find(">.placeholder").hide(),this.$textspan.find(">.title").html(this.getText()).show()):(this.$textspan.find(">.placeholder").text(this.getPlaceHolder()).show(),this.$textspan.find(">.title").html("").hide())},getVal:function(){var e="";return this.$dropdown.find(".city-select").each(function(){var t=h(this).data("item");t&&(e+=(h(this).hasClass("province")?"":"/")+t.address)}),e},feedVal:function(){this.$element.val(this.getVal())},output:function(n){var t,e,i,c,s=this.options,o=this["$"+n],a=n===l?{}:[],d=null;o&&o.length&&(t=o.data("item"),c=(t?t.address:null)||s[n],i=n===l?86:n===p?this.$province&&this.$province.find(".active").data("code"):n===u?this.$city&&this.$city.find(".active").data("code"):i,e=h.isNumeric(i)?r[i]:null,h.isPlainObject(e)&&h.each(e,function(t,e){var i;if(n===l){i=[];for(var s=0;s<e.length;s++)e[s].address===c&&(d={code:e[s].code,address:e[s].address}),i.push({code:e[s].code,address:e[s].address,selected:e[s].address===c});a[t]=i}else e===c&&(d={code:t,address:e}),a.push({code:t,address:e,selected:e===c})}),o.html(n===l?this.getProvinceList(a):this.getList(a,n)),o.data("item",d))},getProvinceList:function(t){var i=[],s=this,n=this.options.simple;return h.each(t,function(t,e){i.push('<dl class="clearfix">'),i.push("<dt>"+t+"</dt><dd>"),h.each(e,function(t,e){i.push('<a title="'+(e.address||"")+'" data-code="'+(e.code||"")+'" class="'+(e.selected?" active":"")+'">'+(n?s.simplize(e.address,l):e.address)+"</a>")}),i.push("</dd></dl>")}),i.join("")},getList:function(t,i){var s=[],n=this,c=this.options.simple;return s.push('<dl class="clearfix"><dd>'),h.each(t,function(t,e){s.push('<a title="'+(e.address||"")+'" data-code="'+(e.code||"")+'" class="'+(e.selected?" active":"")+'">'+(c?n.simplize(e.address,i):e.address)+"</a>")}),s.push("</dd></dl>"),s.join("")},simplize:function(t,e){return t=t||"",e===l?t.replace(/[省,市,自治区,壮族,回族,维吾尔]/g,""):e===p?t.replace(/[市,地区,回族,蒙古,苗族,白族,傣族,景颇族,藏族,彝族,壮族,傈僳族,布依族,侗族]/g,"").replace("哈萨克","").replace("自治州","").replace(/自治县/,""):e===u?2<t.length?t.replace(/[市,区,县,旗]/g,""):t:void 0},tab:function(t){var e=this.$dropdown.find(".city-select"),i=this.$dropdown.find(".city-select-tab > a"),s=this["$"+t],n=this.$dropdown.find('.city-select-tab > a[data-count="'+t+'"]');s&&(e.hide(),s.show(),i.removeClass("active"),n.addClass("active"))},reset:function(){this.$element.val(null).trigger("change")},destroy:function(){this.unbind(),this.$element.removeData(o).removeClass("city-picker-input"),this.$textspan.remove(),this.$dropdown.remove()}},a.DEFAULTS={simple:!1,responsive:!1,placeholder:"请选择省/市/区",level:"district",province:"",city:"",district:""},a.setDefaults=function(t){h.extend(a.DEFAULTS,t)},a.other=h.fn.citypicker,h.fn.citypicker=function(n){var c=[].slice.call(arguments,1);return this.each(function(){var t,e,i=h(this),s=i.data(o);if(!s){if(/destroy/.test(n))return;t=h.extend({},i.data(),h.isPlainObject(n)&&n),i.data(o,s=new a(this,t))}"string"==typeof n&&h.isFunction(e=s[n])&&e.apply(s,c)})},h.fn.citypicker.Constructor=a,h.fn.citypicker.setDefaults=a.setDefaults,h.fn.citypicker.noConflict=function(){return h.fn.citypicker=a.other,this},h(function(){h('[data-toggle="city-picker"]').citypicker()})});